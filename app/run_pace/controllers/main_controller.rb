module RunPace
  class MainController < Volt::ModelController
    def index
      # Add code for when the index view is loaded
    end

    def about
      # Add code for when the about view is loaded
    end

    private

    VDOT_Table = {85=>{:"1500"=>203, :mile=>219, :"3k"=>434, :"2mile"=>468, :"5k"=>757, :"8k"=>1250, :"5mile"=>1258, :"10k"=>1579, :"15k"=>2417, :"10mile"=>2606, :"20k"=>3280, :"12_marathon"=>3470, :"25k"=>4173, :"30k"=>5073, :marathon=>7270}, 84=>{:"1500"=>205, :mile=>221, :"3k"=>438, :"2mile"=>473, :"5k"=>765, :"8k"=>1262, :"5mile"=>1270, :"10k"=>1594, :"15k"=>2442, :"10mile"=>2633, :"20k"=>3314, :"12_marathon"=>3505, :"25k"=>4215, :"30k"=>5125, :marathon=>7344}, 83=>{:"1500"=>207, :mile=>224, :"3k"=>443, :"2mile"=>478, :"5k"=>773, :"8k"=>1276, :"5mile"=>1284, :"10k"=>1611, :"15k"=>2466, :"10mile"=>2659, :"20k"=>3348, :"12_marathon"=>3541, :"25k"=>4259, :"30k"=>5178, :marathon=>7420}, 82=>{:"1500"=>209, :mile=>226, :"3k"=>447, :"2mile"=>483, :"5k"=>781, :"8k"=>1289, :"5mile"=>1297, :"10k"=>1627, :"15k"=>2492, :"10mile"=>2687, :"20k"=>3383, :"12_marathon"=>3578, :"25k"=>4303, :"30k"=>5232, :marathon=>7497}, 81=>{:"1500"=>211, :mile=>228, :"3k"=>452, :"2mile"=>488, :"5k"=>789, :"8k"=>1302, :"5mile"=>1310, :"10k"=>1644, :"15k"=>2518, :"10mile"=>2715, :"20k"=>3418, :"12_marathon"=>3615, :"25k"=>4348, :"30k"=>5287, :marathon=>7577}, 80=>{:"1500"=>214, :mile=>231, :"3k"=>457, :"2mile"=>494, :"5k"=>798, :"8k"=>1316, :"5mile"=>1324, :"10k"=>1661, :"15k"=>2545, :"10mile"=>2744, :"20k"=>3454, :"12_marathon"=>3654, :"25k"=>4395, :"30k"=>5344, :marathon=>7658}, 79=>{:"1500"=>216, :mile=>233, :"3k"=>463, :"2mile"=>500, :"5k"=>806, :"8k"=>1330, :"5mile"=>1338, :"10k"=>1679, :"15k"=>2572, :"10mile"=>2773, :"20k"=>3492, :"12_marathon"=>3694, :"25k"=>4443, :"30k"=>5402, :marathon=>7742}, 78=>{:"1500"=>218, :mile=>236, :"3k"=>468, :"2mile"=>505, :"5k"=>815, :"8k"=>1344, :"5mile"=>1352, :"10k"=>1697, :"15k"=>2600, :"10mile"=>2804, :"20k"=>3531, :"12_marathon"=>3735, :"25k"=>4492, :"30k"=>5462, :marathon=>7827}, 77=>{:"1500"=>221, :mile=>238, :"3k"=>473, :"2mile"=>511, :"5k"=>824, :"8k"=>1359, :"5mile"=>1368, :"10k"=>1716, :"15k"=>2629, :"10mile"=>2835, :"20k"=>3570, :"12_marathon"=>3776, :"25k"=>4541, :"30k"=>5522, :marathon=>7914}, 76=>{:"1500"=>224, :mile=>242, :"3k"=>478, :"2mile"=>517, :"5k"=>834, :"8k"=>1375, :"5mile"=>1383, :"10k"=>1735, :"15k"=>2658, :"10mile"=>2866, :"20k"=>3610, :"12_marathon"=>3819, :"25k"=>4593, :"30k"=>5585, :marathon=>8003}, 75=>{:"1500"=>226, :mile=>244, :"3k"=>484, :"2mile"=>523, :"5k"=>843, :"8k"=>1390, :"5mile"=>1398, :"10k"=>1754, :"15k"=>2688, :"10mile"=>2899, :"20k"=>3652, :"12_marathon"=>3863, :"25k"=>4646, :"30k"=>5649, :marathon=>8095}, 74=>{:"1500"=>229, :mile=>247, :"3k"=>490, :"2mile"=>529, :"5k"=>853, :"8k"=>1406, :"5mile"=>1414, :"10k"=>1774, :"15k"=>2719, :"10mile"=>2932, :"20k"=>3694, :"12_marathon"=>3908, :"25k"=>4700, :"30k"=>5714, :marathon=>8189}, 73=>{:"1500"=>232, :mile=>250, :"3k"=>496, :"2mile"=>535, :"5k"=>863, :"8k"=>1422, :"5mile"=>1431, :"10k"=>1795, :"15k"=>2751, :"10mile"=>2967, :"20k"=>3737, :"12_marathon"=>3954, :"25k"=>4755, :"30k"=>5782, :marathon=>8285}, 72=>{:"1500"=>234, :mile=>253, :"3k"=>502, :"2mile"=>542, :"5k"=>873, :"8k"=>1439, :"5mile"=>1448, :"10k"=>1816, :"15k"=>2784, :"10mile"=>3002, :"20k"=>3783, :"12_marathon"=>4002, :"25k"=>4813, :"30k"=>5851, :marathon=>8384}, 71=>{:"1500"=>237, :mile=>256, :"3k"=>508, :"2mile"=>549, :"5k"=>884, :"8k"=>1456, :"5mile"=>1465, :"10k"=>1838, :"15k"=>2818, :"10mile"=>3039, :"20k"=>3829, :"12_marathon"=>4051, :"25k"=>4871, :"30k"=>5922, :marathon=>8486}, 70=>{:"1500"=>240, :mile=>259, :"3k"=>514, :"2mile"=>556, :"5k"=>895, :"8k"=>1474, :"5mile"=>1483, :"10k"=>1860, :"15k"=>2852, :"10mile"=>3076, :"20k"=>3876, :"12_marathon"=>4101, :"25k"=>4931, :"30k"=>5995, :marathon=>8590}, 69=>{:"1500"=>243, :mile=>263, :"3k"=>521, :"2mile"=>563, :"5k"=>906, :"8k"=>1492, :"5mile"=>1501, :"10k"=>1883, :"15k"=>2888, :"10mile"=>3115, :"20k"=>3924, :"12_marathon"=>4152, :"25k"=>4993, :"30k"=>6070, :marathon=>8697}, 68=>{:"1500"=>246, :mile=>266, :"3k"=>528, :"2mile"=>570, :"5k"=>918, :"8k"=>1511, :"5mile"=>1520, :"10k"=>1906, :"15k"=>2924, :"10mile"=>3154, :"20k"=>3974, :"12_marathon"=>4205, :"25k"=>5056, :"30k"=>6147, :marathon=>8807}, 67=>{:"1500"=>250, :mile=>270, :"3k"=>535, :"2mile"=>577, :"5k"=>929, :"8k"=>1530, :"5mile"=>1540, :"10k"=>1931, :"15k"=>2962, :"10mile"=>3195, :"20k"=>4026, :"12_marathon"=>4260, :"25k"=>5122, :"30k"=>6226, :marathon=>8920}, 66=>{:"1500"=>253, :mile=>273, :"3k"=>542, :"2mile"=>585, :"5k"=>942, :"8k"=>1550, :"5mile"=>1559, :"10k"=>1955, :"15k"=>3000, :"10mile"=>3236, :"20k"=>4079, :"12_marathon"=>4316, :"25k"=>5189, :"30k"=>6308, :marathon=>9036}, 65=>{:"1500"=>256, :mile=>277, :"3k"=>549, :"2mile"=>593, :"5k"=>954, :"8k"=>1570, :"5mile"=>1580, :"10k"=>1981, :"15k"=>3040, :"10mile"=>3279, :"20k"=>4133, :"12_marathon"=>4373, :"25k"=>5258, :"30k"=>6391, :marathon=>9155}, 64=>{:"1500"=>260, :mile=>281, :"3k"=>557, :"2mile"=>601, :"5k"=>967, :"8k"=>1592, :"5mile"=>1601, :"10k"=>2008, :"15k"=>3081, :"10mile"=>3323, :"20k"=>4190, :"12_marathon"=>4433, :"25k"=>5329, :"30k"=>6477, :marathon=>9278}, 63=>{:"1500"=>264, :mile=>285, :"3k"=>565, :"2mile"=>610, :"5k"=>980, :"8k"=>1613, :"5mile"=>1623, :"10k"=>2035, :"15k"=>3123, :"10mile"=>3369, :"20k"=>4247, :"12_marathon"=>4494, :"25k"=>5402, :"30k"=>6566, :marathon=>9404}, 62=>{:"1500"=>267, :mile=>289, :"3k"=>573, :"2mile"=>618, :"5k"=>994, :"8k"=>1635, :"5mile"=>1645, :"10k"=>2063, :"15k"=>3167, :"10mile"=>3416, :"20k"=>4307, :"12_marathon"=>4557, :"25k"=>5478, :"30k"=>6657, :marathon=>9534}, 61=>{:"1500"=>271, :mile=>293, :"3k"=>581, :"2mile"=>627, :"5k"=>1008, :"8k"=>1658, :"5mile"=>1669, :"10k"=>2092, :"15k"=>3212, :"10mile"=>3465, :"20k"=>4368, :"12_marathon"=>4622, :"25k"=>5555, :"30k"=>6751, :marathon=>9668}, 60=>{:"1500"=>275, :mile=>297, :"3k"=>590, :"2mile"=>637, :"5k"=>1023, :"8k"=>1682, :"5mile"=>1693, :"10k"=>2122, :"15k"=>3258, :"10mile"=>3515, :"20k"=>4431, :"12_marathon"=>4689, :"25k"=>5635, :"30k"=>6848, :marathon=>9805}, 59=>{:"1500"=>279, :mile=>302, :"3k"=>598, :"2mile"=>646, :"5k"=>1037, :"8k"=>1706, :"5mile"=>1716, :"10k"=>2152, :"15k"=>3306, :"10mile"=>3566, :"20k"=>4497, :"12_marathon"=>4758, :"25k"=>5718, :"30k"=>6948, :marathon=>9947}, 58=>{:"1500"=>284, :mile=>306, :"3k"=>608, :"2mile"=>656, :"5k"=>1053, :"8k"=>1732, :"5mile"=>1742, :"10k"=>2184, :"15k"=>3355, :"10mile"=>3620, :"20k"=>4565, :"12_marathon"=>4830, :"25k"=>5804, :"30k"=>7051, :marathon=>10094}, 57=>{:"1500"=>288, :mile=>311, :"3k"=>617, :"2mile"=>666, :"5k"=>1069, :"8k"=>1758, :"5mile"=>1769, :"10k"=>2217, :"15k"=>3406, :"10mile"=>3674, :"20k"=>4634, :"12_marathon"=>4903, :"25k"=>5891, :"30k"=>7157, :marathon=>10245}, 56=>{:"1500"=>293, :mile=>316, :"3k"=>627, :"2mile"=>677, :"5k"=>1085, :"8k"=>1785, :"5mile"=>1795, :"10k"=>2251, :"15k"=>3459, :"10mile"=>3732, :"20k"=>4706, :"12_marathon"=>4980, :"25k"=>5983, :"30k"=>7267, :marathon=>10400}, 55=>{:"1500"=>297, :mile=>321, :"3k"=>637, :"2mile"=>688, :"5k"=>1102, :"8k"=>1812, :"5mile"=>1823, :"10k"=>2286, :"15k"=>3513, :"10mile"=>3790, :"20k"=>4780, :"12_marathon"=>5058, :"25k"=>6076, :"30k"=>7380, :marathon=>10561}, 54=>{:"1500"=>302, :mile=>327, :"3k"=>647, :"2mile"=>699, :"5k"=>1120, :"8k"=>1841, :"5mile"=>1852, :"10k"=>2322, :"15k"=>3570, :"10mile"=>3852, :"20k"=>4857, :"12_marathon"=>5140, :"25k"=>6173, :"30k"=>7498, :marathon=>10727}, 53=>{:"1500"=>307, :mile=>332, :"3k"=>658, :"2mile"=>710, :"5k"=>1138, :"8k"=>1871, :"5mile"=>1883, :"10k"=>2360, :"15k"=>3628, :"10mile"=>3914, :"20k"=>4937, :"12_marathon"=>5224, :"25k"=>6274, :"30k"=>7619, :marathon=>10899}, 52=>{:"1500"=>313, :mile=>338, :"3k"=>669, :"2mile"=>722, :"5k"=>1157, :"8k"=>1902, :"5mile"=>1914, :"10k"=>2399, :"15k"=>3689, :"10mile"=>3980, :"20k"=>5019, :"12_marathon"=>5311, :"25k"=>6377, :"30k"=>7744, :marathon=>11076}, 51=>{:"1500"=>318, :mile=>344, :"3k"=>681, :"2mile"=>735, :"5k"=>1176, :"8k"=>1934, :"5mile"=>1946, :"10k"=>2439, :"15k"=>3751, :"10mile"=>4047, :"20k"=>5105, :"12_marathon"=>5402, :"25k"=>6485, :"30k"=>7873, :marathon=>11259}, 50=>{:"1500"=>324, :mile=>350, :"3k"=>693, :"2mile"=>748, :"5k"=>1197, :"8k"=>1967, :"5mile"=>1979, :"10k"=>2481, :"15k"=>3816, :"10mile"=>4117, :"20k"=>5193, :"12_marathon"=>5495, :"25k"=>6596, :"30k"=>8007, :marathon=>11449}, 49=>{:"1500"=>330, :mile=>356, :"3k"=>705, :"2mile"=>761, :"5k"=>1218, :"8k"=>2002, :"5mile"=>2014, :"10k"=>2524, :"15k"=>3884, :"10mile"=>4190, :"20k"=>5285, :"12_marathon"=>5592, :"25k"=>6712, :"30k"=>8147, :marathon=>11646}, 48=>{:"1500"=>336, :mile=>363, :"3k"=>718, :"2mile"=>775, :"5k"=>1239, :"8k"=>2038, :"5mile"=>2050, :"10k"=>2570, :"15k"=>3953, :"10mile"=>4265, :"20k"=>5380, :"12_marathon"=>5693, :"25k"=>6832, :"30k"=>8291, :marathon=>11849}, 47=>{:"1500"=>342, :mile=>370, :"3k"=>732, :"2mile"=>790, :"5k"=>1262, :"8k"=>2074, :"5mile"=>2087, :"10k"=>2616, :"15k"=>4026, :"10mile"=>4344, :"20k"=>5479, :"12_marathon"=>5798, :"25k"=>6956, :"30k"=>8440, :marathon=>12060}, 46=>{:"1500"=>349, :mile=>377, :"3k"=>746, :"2mile"=>805, :"5k"=>1285, :"8k"=>2113, :"5mile"=>2126, :"10k"=>2665, :"15k"=>4102, :"10mile"=>4426, :"20k"=>5582, :"12_marathon"=>5907, :"25k"=>7086, :"30k"=>8596, :marathon=>12279}, 45=>{:"1500"=>356, :mile=>385, :"3k"=>760, :"2mile"=>820, :"5k"=>1310, :"8k"=>2154, :"5mile"=>2167, :"10k"=>2716, :"15k"=>4180, :"10mile"=>4510, :"20k"=>5689, :"12_marathon"=>6020, :"25k"=>7220, :"30k"=>8757, :marathon=>12506}, 44=>{:"1500"=>363, :mile=>392, :"3k"=>775, :"2mile"=>836, :"5k"=>1335, :"8k"=>2195, :"5mile"=>2209, :"10k"=>2769, :"15k"=>4262, :"10mile"=>4598, :"20k"=>5800, :"12_marathon"=>6137, :"25k"=>7359, :"30k"=>8925, :marathon=>12743}, 43=>{:"1500"=>371, :mile=>401, :"3k"=>791, :"2mile"=>853, :"5k"=>1361, :"8k"=>2239, :"5mile"=>2252, :"10k"=>2824, :"15k"=>4347, :"10mile"=>4690, :"20k"=>5916, :"12_marathon"=>6260, :"25k"=>7505, :"30k"=>9099, :marathon=>12988}, 42=>{:"1500"=>379, :mile=>409, :"3k"=>808, :"2mile"=>871, :"5k"=>1389, :"8k"=>2284, :"5mile"=>2298, :"10k"=>2881, :"15k"=>4436, :"10mile"=>4786, :"20k"=>6036, :"12_marathon"=>6387, :"25k"=>7655, :"30k"=>9280, :marathon=>13243}, 41=>{:"1500"=>387, :mile=>418, :"3k"=>825, :"2mile"=>889, :"5k"=>1418, :"8k"=>2332, :"5mile"=>2346, :"10k"=>2941, :"15k"=>4529, :"10mile"=>4886, :"20k"=>6162, :"12_marathon"=>6520, :"25k"=>7813, :"30k"=>9469, :marathon=>13509}, 40=>{:"1500"=>395, :mile=>427, :"3k"=>843, :"2mile"=>908, :"5k"=>1448, :"8k"=>2381, :"5mile"=>2396, :"10k"=>3003, :"15k"=>4626, :"10mile"=>4991, :"20k"=>6293, :"12_marathon"=>6659, :"25k"=>7977, :"30k"=>9666, :marathon=>13785}, 39=>{:"1500"=>404, :mile=>437, :"3k"=>861, :"2mile"=>929, :"5k"=>1479, :"8k"=>2433, :"5mile"=>2448, :"10k"=>3069, :"15k"=>4727, :"10mile"=>5099, :"20k"=>6430, :"12_marathon"=>6804, :"25k"=>8149, :"30k"=>9872, :marathon=>14074}, 38=>{:"1500"=>414, :mile=>447, :"3k"=>881, :"2mile"=>949, :"5k"=>1512, :"8k"=>2487, :"5mile"=>2502, :"10k"=>3137, :"15k"=>4833, :"10mile"=>5214, :"20k"=>6573, :"12_marathon"=>6955, :"25k"=>8328, :"30k"=>10086, :marathon=>14375}, 37=>{:"1500"=>424, :mile=>458, :"3k"=>901, :"2mile"=>971, :"5k"=>1546, :"8k"=>2544, :"5mile"=>2559, :"10k"=>3209, :"15k"=>4944, :"10mile"=>5333, :"20k"=>6723, :"12_marathon"=>7114, :"25k"=>8515, :"30k"=>10311, :marathon=>14690}, 36=>{:"1500"=>434, :mile=>469, :"3k"=>923, :"2mile"=>994, :"5k"=>1582, :"8k"=>2603, :"5mile"=>2619, :"10k"=>3284, :"15k"=>5060, :"10mile"=>5458, :"20k"=>6880, :"12_marathon"=>7279, :"25k"=>8711, :"30k"=>10545, :marathon=>15019}, 35=>{:"1500"=>445, :mile=>481, :"3k"=>945, :"2mile"=>1018, :"5k"=>1620, :"8k"=>2666, :"5mile"=>2682, :"10k"=>3363, :"15k"=>5182, :"10mile"=>5589, :"20k"=>7044, :"12_marathon"=>7453, :"25k"=>8916, :"30k"=>10791, :marathon=>15363}, 34=>{:"1500"=>457, :mile=>494, :"3k"=>969, :"2mile"=>1044, :"5k"=>1659, :"8k"=>2731, :"5mile"=>2748, :"10k"=>3446, :"15k"=>5310, :"10mile"=>5727, :"20k"=>7217, :"12_marathon"=>7636, :"25k"=>9132, :"30k"=>11048, :marathon=>15723}, 33=>{:"1500"=>469, :mile=>507, :"3k"=>993, :"2mile"=>1070, :"5k"=>1701, :"8k"=>2801, :"5mile"=>2818, :"10k"=>3534, :"15k"=>5445, :"10mile"=>5872, :"20k"=>7398, :"12_marathon"=>7827, :"25k"=>9358, :"30k"=>11319, :marathon=>16102}, 32=>{:"1500"=>482, :mile=>521, :"3k"=>1019, :"2mile"=>1098, :"5k"=>1745, :"8k"=>2874, :"5mile"=>2891, :"10k"=>3626, :"15k"=>5587, :"10mile"=>6025, :"20k"=>7589, :"12_marathon"=>8029, :"25k"=>9596, :"30k"=>11603, :marathon=>16499}, 31=>{:"1500"=>495, :mile=>535, :"3k"=>1047, :"2mile"=>1128, :"5k"=>1791, :"8k"=>2950, :"5mile"=>2968, :"10k"=>3723, :"15k"=>5736, :"10mile"=>6185, :"20k"=>7790, :"12_marathon"=>8241, :"25k"=>9846, :"30k"=>11902, :marathon=>16917}, 30=>{:"1500"=>510, :mile=>551, :"3k"=>1076, :"2mile"=>1159, :"5k"=>1840, :"8k"=>3032, :"5mile"=>3050, :"10k"=>3826, :"15k"=>5894, :"10mile"=>6355, :"20k"=>8001, :"12_marathon"=>8464, :"25k"=>10109, :"30k"=>12217, :marathon=>17357}}


    Col_Names = {
      :"1500"=>"1500 Meters",
      :mile=> "Mile",
      :"3k"=> "3k",
      :"2mile"=> "2 Mile",
      :"5k"=> "5k",
      :"8k"=> "8k",
      :"5mile"=>"5 Mile",
      :"10k"=>"10k",
      :"15k"=>"15k",
      :"10mile"=>"10 Mile",
      :"20k"=>"20k",
      :"12_marathon"=>"1/2 Marathon",
      :"25k"=>"25k",
      :"30k"=>"30k",
      :marathon=>"Marathon"
    }

    def col_names
      Col_Names
    end

    Col_Distances = {
      :"1500"=> 0.932057,
      :mile=> 1,
      :"3k"=> 1.86411,
      :"2mile"=> 2.0,
      :"5k"=>3.10686,
      :"8k"=>4.97097,
      :"5mile"=>5,
      :"10k"=>6.21371,
      :"15k"=>9.32057,
      :"10mile"=>10,
      :"20k"=>12.4274,
      :"12_marathon"=>13.109375,
      :"25k"=>15.5343,
      :"30k"=>18.6411,
      :marathon=>26.21875
    }

    def col_distances
      Col_Distances
    end

    def convert_time(time_str)
      splits = time_str.split(':').map{|v| v.to_i}
      case splits.size
      when 1
        return splits[0]
      when 2
        return splits[1] + splits[0] * 60
      when 3
        return splits[2] + splits[1] * 60 + splits[0] * 3600
      end
    end

    def unconvert_time(seconds, level = 3)
      time = []
      seconds = seconds.to_i

      time << (seconds / 3600).floor
      seconds %= 3600
      time << (seconds / 60).floor
      seconds %=60
      time << (seconds).round(0)

      while time.size > level
        time = time[1..-1]
      end

      time.map{|t| "%02d" % t}.join(':')
    end

    def index_ready
      #Do google charts stuff
      `
        google.setOnLoadCallback(drawChart);
          function drawChart() {
            var data = google.visualization.arrayToDataTable(
              []
              , true);

            var options = {
              legend:'none',
              curveType: 'function',
            };

            var chart = new google.visualization.LineChart(document.getElementById('pace_chart'));

            chart.draw(data, options);
          }

      `
    end

    def vdot
      return unless page._distance && page._run_time

      distance = page._distance
      time = page._run_time

      target_time = convert_time(time)

      prev_delta = Float::INFINITY
      prev_nearest = nil

      VDOT_Table.each {|vdot, times|
        delta = (times[distance] - target_time).abs

        if delta < prev_delta
          prev_delta = delta
          prev_nearest = vdot
        else
          break
        end
      }

      return prev_nearest
    end

    def performance_finish_time
      return {} unless vdot

      row = VDOT_Table[vdot]

      Hash[
        row.map {|d, t|
          [col_names[d], unconvert_time(t)]
        }
      ]
    end

    def performance_pace
      return {} unless vdot

      row = VDOT_Table[vdot]

      paces_chart_data = row.map {|d, t| [col_names[d], t, 1] }
      paces_chart_data = [['Distance', 'Pace', 'why']] + paces_chart_data
      performance_pace_chart(paces_chart_data)

      paces = Hash[
        row.map {|d, t|
          [col_names[d], unconvert_time(t/col_distances[d], 2)]
        }
      ]
      paces
    end

    def performance_pace_chart(pace_data)
      p pace_data
      if RUBY_PLATFORM == 'opal'
        `
          var data = google.visualization.arrayToDataTable(#{pace_data});

          var options = {
            title: 'Company Performance',
            curveType: 'function',
            legend: { position: 'bottom' }
          };

          var chart = new google.visualization.LineChart(document.getElementById('pace_chart'));

          chart.draw(data, options);
        `
      end
    end


    # the main template contains a #template binding that shows another
    # template.  This is the path to that template.  It may change based
    # on the params._controller and params._action values.
    def main_path
      "#{params._component || 'main'}/#{params._controller || 'main'}/#{params._action || 'index'}"
    end
  end
end
